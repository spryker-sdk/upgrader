services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: true

# Upgrade
    Upgrade\Application\:
        resource: '../../../../Upgrade/Application/*'
        exclude:
            - '../../../../Upgrade/Application/Dto/*'

    Upgrade\Infrastructure\:
        resource: '../../../../Upgrade/Infrastructure/*'

    Upgrade\Infrastructure\VersionControlSystem\Git\Adapter\GitAdapter: ~
    Upgrade\Infrastructure\VersionControlSystem\Adapter\VersionControlSystemAdapterInterface: '@Upgrade\Infrastructure\VersionControlSystem\Git\Adapter\GitAdapter'

    Upgrade\Infrastructure\Services\UpgraderService: ~
    Upgrade\Application\Services\UpgraderServiceInterface: '@Upgrade\Application\Service\UpgraderService'

    git.adapter:
        class: Upgrade\Infrastructure\VersionControlSystem\Git\Adapter\GitAdapter

    Upgrade\Infrastructure\VersionControlSystem\Adapter\Resolver\VersionControlSystemAdapterResolver:
        class: Upgrade\Infrastructure\VersionControlSystem\Adapter\Resolver\VersionControlSystemAdapterResolver
        arguments:
            - {
                param1: '@git.adapter'
              }

    upgrade.task:
        class: Upgrade\Infrastructure\Task\UpgradeTask
        tags: [ 'sdk.task' ]

    check_is_remote_target_branch_exist.step:
        class: Upgrade\Domain\Strategy\CommonStep\CheckRemoteTargetBranchExistsStep

    check_is_local_target_branch_exist.step:
        class: Upgrade\Domain\Strategy\CommonStep\CheckLocalTargetBranchExistsStep

    check_uncommitted_changes.step:
        class: Upgrade\Domain\Strategy\CommonStep\CheckUncommittedChangesStep

    composer_update.step:
        class: Upgrade\Domain\Strategy\Composer\Step\ComposerUpdateStep

    composer_lock_diff.step:
        class: Upgrade\Domain\Strategy\CommonStep\ComposerLockComparatorStep

    create_branch.step:
        class: Upgrade\Domain\Strategy\CommonStep\CreateBranchStep

    add_changes.step:
        class: Upgrade\Domain\Strategy\CommonStep\AddChangesStep

    commit_changes.step:
        class: Upgrade\Domain\Strategy\CommonStep\CommitChangesStep

    push_changes.step:
        class: Upgrade\Domain\Strategy\CommonStep\PushChangesStep

    create_pr.step:
        class: Upgrade\Domain\Strategy\CommonStep\CreatePullRequestStep

    checkout.step:
        class: Upgrade\Domain\Strategy\CommonStep\CheckoutStep

    release_group_update.step:
        class: Upgrade\Domain\Strategy\ReleaseApp\Step\ReleaseGroupUpdateStep

    composer.strategy:
        class: Upgrade\Domain\Strategy\Composer\ComposerStrategy
        arguments:
            - {
                param1: '@check_is_remote_target_branch_exist.step',
                param2: '@check_is_local_target_branch_exist.step',
                param3: '@check_uncommitted_changes.step',
                param4: '@composer_update.step',
                param5: '@composer_lock_diff.step',
                param6: '@create_branch.step',
                param7: '@add_changes.step',
                param8: '@commit_changes.step',
                param9: '@push_changes.step',
                param10: '@create_pr.step',
                param11: '@checkout.step'
             }

    release-app.strategy:
        class: Upgrade\Domain\Strategy\ReleaseApp\ReleaseAppStrategy
        arguments:
            - {
                param1: '@check_is_remote_target_branch_exist.step',
                param2: '@check_is_local_target_branch_exist.step',
                param3: '@check_uncommitted_changes.step',
                param4: '@release_group_update.step',
                param5: '@composer_lock_diff.step',
                param6: '@create_branch.step',
                param7: '@add_changes.step',
                param8: '@commit_changes.step',
                param9: '@push_changes.step',
                param10: '@create_pr.step',
                param11: '@checkout.step'
            }

    Upgrade\Infrastructure\Strategy\StrategyResolver:
        class: Upgrade\Domain\Strategy\StrategyResolver
        arguments:
            - {
                param1: '@composer.strategy',
                param2: '@release-app.strategy'
            }

    github.provider:
        class: Upgrade\Infrastructure\VersionControlSystem\Provider\GitHub\GitHubProvider

    configuration.provider:
        class: Upgrade\Infrastructure\Configuration\ConfigurationProvider

    Upgrade\Infrastructure\VersionControlSystem\Provider\SourceCodeProvider:
        class: Upgrade\Infrastructure\VersionControlSystem\Provider\SourceCodeProvider
        arguments:
            - '@configuration.provider'
            - {
                param1: '@github.provider'
            }

    validator.already_installed:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\Package\AlreadyInstalledValidator

    Upgrade\Infrastructure\Strategy\ReleaseApp\Validator\PackageSoftValidator:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\PackageSoftValidator
        arguments:
            - {
                param1: '@validator.already_installed'
            }

    validator.project_changes:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\ReleaseGroup\ProjectChangesValidator

    validator.release_major:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\ReleaseGroup\MajorVersionValidator

    Upgrade\Infrastructure\Strategy\ReleaseApp\Validator\ReleaseGroupSoftValidator:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\ReleaseGroupSoftValidator
        arguments:
            - {
                param1: '@validator.project_changes',
                param2: '@validator.release_major',
            }

    validator.threshold_major:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\Threshold\MajorThresholdValidator

    validator.threshold_minor:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\Threshold\MinorThresholdValidator

    validator.threshold_path:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\Threshold\PathThresholdValidator

    validator.threshold_release_group:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\Threshold\ReleaseGroupThresholdValidator

    Upgrade\Infrastructure\Strategy\ReleaseApp\Validator\ThresholdSoftValidator:
        class: Upgrade\Domain\Strategy\ReleaseApp\Validator\ThresholdSoftValidator
        arguments:
            - {
                param1: '@validator.threshold_major',
                param2: '@validator.threshold_minor',
                param3: '@validator.threshold_path',
                param4: '@validator.threshold_release_group',
            }

    processor.aggregate_release_group_require:
        class: Upgrade\Domain\Strategy\ReleaseApp\Processor\AggregateReleaseGroupRequireProcessor

    processor.sequential_release_group_require:
        class: Upgrade\Domain\Strategy\ReleaseApp\Processor\SequentialReleaseGroupRequireProcessor

    Upgrade\Infrastructure\Strategy\ReleaseApp\Processor\ReleaseGroupRequireProcessorResolver:
        class: Upgrade\Domain\Strategy\ReleaseApp\Processor\ReleaseGroupRequireProcessorResolver
        arguments:
            - '@configuration.provider'
            - {
                param1: '@processor.aggregate_release_group_require',
                param2: '@processor.sequential_release_group_require',
            }

    client.release_app:
        class: ReleaseAppClient\Application\Client\ReleaseAppClient

    client.package_manager:
        class: PackageManager\Application\Service\PackageManagerService

    Upgrade\Infrastructure\Strategy\ReleaseApp\Bridge\ReleaseAppClientBridge:
        class: Upgrade\Domain\Strategy\ReleaseApp\Bridge\ReleaseAppClientBridge
        arguments:
            - '@client.release_app'
            - '@client.package_manager'

    #Third-party dependencies
    Ergebnis\Json\Printer\Printer: ~
    Ergebnis\Json\Printer\PrinterInterface: '@Ergebnis\Json\Printer\Printer'


